/* Formatted on 02/12/2015 14:54:47 (QP5 v5.287) */
SELECT T.CUSTOMER_ID || ',' ||
       T.CHAIN_ID ||  ',' ||
       T.OFFER_ID||  ',' ||
       T.MARKET_ID||  ',' ||
       T.OFFER_DATE||  ',' ||
       A.COMPANY_ID||  ',' ||
       T.REPEAT_TRIPS||  ',' ||
       NVL(A.PURCHASE_TIMES,0) PURCHASE_TIMES
  FROM TRAIN_HISTORY T, OFFERS OFF, BOUGHT_OFFER_COMPANY A
 WHERE     T.OFFER_ID = OFF.OFFER_ID(+)
       AND A.CUSTOMER_ID(+) = T.CUSTOMER_ID
       ORDER BY PURCHASE_TIMES DESC;
       
 select FILE_NAME,TABLESPACE_NAME,BYTES/1024/1024,MAXBYTES/1024/1024 from dba_data_files;
 
 ALTER SYSTEM SET undo_tablespace = UNDOTBS2 SCOPE=BOTH;
 
 select table_name, tablespace_name
   from user_tables
    where table_name = 'TRANSACTIONS';
    
    ALTER TABLESPACE USERS
 ADD DATAFILE 'C:\ORACLEXE\APP\ORACLE\ORADATA\XE\USERS1.DBF'
   SIZE 10G
   AUTOEXTEND ON;
   
   CREATE UNDO TABLESPACE UNDOTBS2
DATAFILE 'C:\ORACLEXE\APP\ORACLE\ORADATA\XE\UNDOTBS2.DBF'
SIZE 5G REUSE AUTOEXTEND ON
RETENTION NOGUARANTEE;

ALTER DATABASE TEMPFILE '/u02/oradata/tempnew02.dbf' RESIZE 250M;

SELECT *
FROM database_properties
WHERE property_name = 'DEFAULT_TEMP_TABLESPACE';
    
   drop table transactions;
   
 CREATE TABLE TRANSACTIONS 
(
   TRANSACTION_ID   NUMBER (10) NOT NULL,
   CHAIN_ID         NUMBER (10) NOT NULL,
   DEPARTMENT_ID    NUMBER (10) NOT NULL,
   CATEGORY_ID      NUMBER (10) NOT NULL,
   COMPANY_ID       NUMBER (20) NOT NULL,
   BRAND_ID         NUMBER (10) NOT NULL,
   PURCHASE_DATE    DATE,
   PROD_SIZE        NUMBER (10, 4),
   PROD_MEASURE     VARCHAR2 (20),
   PURCHASE_QTY     NUMBER (10),
   PURCHASE_AMT     NUMBER (10, 4)
)  TABLESPACE USERS ;   
CREATE TABLESPACE user_tab
  DATAFILE 'C:\ORACLEXE\APP\ORACLE\ORADATA\XE\USERS.DBF' 
    SIZE 10G
  ONLINE;
    drop table offers
    
    CREATE TABLE OFFERS
(
   OFFER_ID              NUMBER (10) NOT NULL,
   CATEGORY_ID           NUMBER (10) NOT NULL,
   MIN_QTY_TO_PURCHASE   NUMBER (5),
   COMPANY_ID            NUMBER (20) NOT NULL,
   OFFER_VALUE           NUMBER (10, 4),
   BRAND_ID              NUMBER (10) NOT NULL,
   CONSTRAINT OFFERS_PK PRIMARY KEY (OFFER_ID)
) TABLESPACE USERS ;

    CREATE TABLE TRAIN_HISTORY
(
   TRAIN_HISTORY_ID   NUMBER (10) NOT NULL,
   CHAIN_ID           NUMBER (10) NOT NULL,
   OFFER_ID           NUMBER (10) NOT NULL,
   MARKET_ID          NUMBER (10),
   REPEAT_TRIPS       NUMBER (10),
   REPEATER           VARCHAR2 (1),
   OFFER_DATE         DATE
) TABLESPACE USERS ;
    
	
	CREATE TABLE TRAIN_HIST AS
  SELECT TRAIN_HISTORY_ID, TH.OFFER_ID, TH.CHAIN_ID, TH.MARKET_ID, TH.REPEAT_TRIPS,
  TH.REPEATER, TH.OFFER_DATE, OFF.CATEGORY_ID, OFF.MIN_QTY_TO_PURCHASE,
  OFF.COMPANY_ID, OFF.OFFER_VALUE, OFF.BRAND_ID
  FROM TRAIN_HISTORY TH , OFFERS OFF WHERE TH.OFFER_ID = OFF.OFFER_ID;  
  
  alter table
   TRAIN_HIST
rename to
   TRAIN_HISTORY;